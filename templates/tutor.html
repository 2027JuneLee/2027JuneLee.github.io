{% extends "header.html" %}
{% block ap %}
<head>
<style>
    body{
        font-family: 'Google Sans Code', serif;
        background-color: #CFE7E0;
    }
    .chat-container {
        max-width: 800px;
        margin-top: 50px;
        padding: 50px 40px;
        border-radius: 10px;
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.3);
        background-color: #EEF7F4;
    }

    .chat-title {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .chat-box {
        background-color: #ECF9F4;
        border: 1px solid #dcdcdc;
        padding: 10px 10px;
        height: 350px;
        border-radius: 5px;
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
    }

    .chat-message {
        max-width: 80%;
        border-radius: 12px;
        color: white;
        padding: 10px 15px;
        background-color:#0B8398;
        margin: 8px 10px;
        display: inline-block;
        font-size: 14px;
        line-height: 1.4;
    }

    .user-input {
        background-color: #54AB91;
        align-self: flex-end;
        text-align: right;
    }

    .bot-input {
        align-self: flex-start;
        text-align: left;
    }

    .chat-input {
        display: flex;
        gap: 10px;
        align-items: center;
    }
.input-wrapper {
    flex-grow: 1;
    min-width: 0;
    position: relative;
}

#text-input-container,
#placeholder {
    width: 100%;
    height: 42px; /* match your input's height */
}

#placeholder {
    visibility: hidden;
}

    .chat-input input[type="file"] {
        display: none;
    }
    .chat-input label{
        background-color:#295F98;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }
    .chat-input label:hover{
        background-color: #367a7c;
    }


    .chat-input input[type="text"] {
        flex-grow: 1;
        border-radius: 5px;
        border: 1px solid #ccc;
        padding: 10px;
        font-size: 16px;
        outline: none;
        transition: border-color 0.3s ease;
    }

    .non-display {
        display: none;
    }

    .chat-input button.upload-btn {
        background-color:#295F98;
        border: none;
        color: white;
        border-radius: 5px;
        padding: 10px 15px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .chat-input button.upload-btn:hover {
        background-color: #367a7c;
    }

    .chat-input button.send-btn {
        background-color:#295F98;
        border: none;
        color: white;
        border-radius: 5px;
        padding: 10px 15px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .chat-input button.send-btn:hover {
        background-color: #367a7c;
    }

    .chat-input input[type="text"]:focus {
        border-color:#cb37dd;
    }
    .result-container{
        margin-top: 50px;
    }
   .card {
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            background-color: ghostwhite;
            margin-bottom: 20px;
        }
        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #343a40;
        }
        .card-text {
            font-size: 1rem;
            color: #6c757d;
        }
.placeholder-text {
    color: #333;
    font-weight: 500;
}
#text-input-container {
    flex-grow: 1;
}
#text-input-container input {
    width: 100%;
}

.bias-distribution {
    display: flex;
    height: 20px;
    width: 100%;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
    background-color: #e0e0e0;
}

.bias-segment {
    height: 100%;
    transition: width 0.4s ease;
}

.left-segment {
    background-color: #d9534f; /* red */
}

.center-segment {
    background-color: #f0ad4e; /* orange */
}

.right-segment {
    background-color: #337ab7; /* blue */
}

.bias-labels {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: #333;
}

</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bitcount+Prop+Single:wght@100..900&family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Winky+Rough:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 px-5">
                <div class="chat-container">
                    <h3 class="chat-title"></h3>
                    <p class="text-center">Ask AI for help, quizzes, and study guides!</p>
                    <div class="chat-box" id="chat-box">
                        <div class="chat-message bot-input">Hello! Please copy and paste the news or upload a PDF file. We'll display the analyzed results on the right side. </div>
                    </div>
<div class="chat-input">
    <label for="file-input"><i class="bi bi-paperclip"></i> Attach File</label>
    <input type="file" id="file-input" accept=".docx, .pdf" onchange="updateFileLabel()">
    <span id="file-name" style="margin-left: 10px; font-size: 14px; color: #555;"></span>

<div class="input-wrapper">
    <div id="text-input-container">
        <input type="text" id="user-input">
    </div>
    <div id="placeholder" style="display: none;"></div>
</div>


    <button onclick="uploadOrSendMessage()" class="send-btn"><i class="bi bi-send-fill"></i></button>
</div>


                </div>
            </div>
            <div class="col-md-6 px-5">
                <div class="result-container">
                    <div class="card">
                        <div class="card-title">Bias Classification</div>
                        <p class="card-text">Bias Class: <span id="bias-class" class="placeholder-text">Not analyzed yet</span></p>
<p class="card-text">Bias Scores:</p>
<div class="bias-distribution">
    <div id="left-bar" class="bias-segment left-segment"></div>
    <div id="center-bar" class="bias-segment center-segment"></div>
    <div id="right-bar" class="bias-segment right-segment"></div>
</div>
<div class="bias-labels">
    <span>Left: <span id="left">--%</span></span>
    <span>Center: <span id="center">--%</span></span>
    <span>Right: <span id="right">--%</span></span>
</div>

                    </div>
                    <div class="card">
                        <div class="card-title">Why Your Solution was Wrong/Slower</div>
                        <p class="card-text"><span id="bias-reason" class="placeholder-text">Analysis pending...</span></p>
                    </div>
                    <div class="card">
                        <div class="card-title">Related Forumlas, Rules & Tips</div>
                        <p class="card-text"><span id="news-summary" class="placeholder-text">Summary will appear here...</span></p>
                    </div>
                    <div class="card">
                        <div class="card-title">Topics</div>
                        <p class="card-text"><span id="keywords" class="placeholder-text">Keywords will be shown here...</span></p>
                    </div>
                </div>

            </div>
        </div>
    </div>

<script>
    function scrollToBottom() {
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;
}

function uploadOrSendMessage() {
    const fileInput = document.getElementById("file-input");
    const userInput = document.getElementById("user-input").value.trim();
    const chatBox = document.getElementById("chat-box");
    const textInputContainer = document.getElementById("text-input-container");

    // Always show input again when send button is clicked
    textInputContainer.style.display = "block";
document.getElementById("placeholder").style.display = "none";

    if (fileInput.files.length > 0) {
        const fileName = fileInput.files[0].name;
        showLoadingMessage(`Analyzing "${fileName}", please wait...`);
        uploadFile(fileInput.files[0]);
        fileInput.value = "";
        document.getElementById("file-name").textContent = "";
    } else if (userInput) {
        sendMessage();
        document.getElementById("user-input").value = '';
    } else {
        chatBox.innerHTML += "<div class='chat-message bot-input'>Please attach a file or enter a message.</div>";
        scrollToBottom();
    }
}

function showLoadingMessage(message = "Analyzing, please wait...") {
    const chatbox = document.getElementById("chat-box");
    chatbox.innerHTML += `<div class='chat-message bot-input'>${message}</div>`;
    scrollToBottom();
}


    // for sending the pdf file to python to get the result of analysis
function uploadFile(file){
    console.log("called");
    formData = new FormData();
    formData.append("pdf_file",file);

    fetch("/upload_pdf",{
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        var chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += "<div class='chat-message bot-input'>" + "Done Processing. Please check the right side." + "</div>";
        updateResult(data);
        scrollToBottom();

        // Show the input again
        document.getElementById("text-input-container").style.display = "block";
        document.getElementById("placeholder").style.display = "none";

    });
}

function updateResult(data) {
    document.getElementById("bias-class").innerText = data.bias_class;

    // Update labels
    document.getElementById("left").innerText = data.left_score + "%";
    document.getElementById("center").innerText = data.center_score + "%";
    document.getElementById("right").innerText = data.right_score + "%";

    // Update segment widths
    document.getElementById("left-bar").style.width = data.left_score + "%";
    document.getElementById("center-bar").style.width = data.center_score + "%";
    document.getElementById("right-bar").style.width = data.right_score + "%";

    // Other updates
    document.getElementById("bias-reason").innerText = data.reason;
    document.getElementById("news-summary").innerText = data.summary;
    document.getElementById("keywords").innerText = data.keywords;
}

    function sendMessage(){
        var userInput = document.getElementById("user-input").value.trim();
        document.getElementById("user-input").value = '';

        var chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += "<div class='chat-message user-input'>" + userInput + "</div>";
        scrollToBottom();
 showLoadingMessage();
        fetch("/get_response", {
            method: "POST",
            headers:{
                "Content-Type": "application/json"
            },
            body: JSON.stringify({message: userInput}),
        })
        .then(response => response.json())
        .then(data => {
            chatBox.innerHTML += "<div class='chat-message bot-input'>" + "Done Processing. Please check the right side." + "</div>";
            scrollToBottom();
//            scrollToBottom();
            updateResult(data);
        })

    }
var user = document.getElementById("user-input");
document.addEventListener('keydown', function (event) {
    if (event.key === 'Enter') {
        const fileInput = document.getElementById("file-input");
        const userInput = document.getElementById("user-input");
        const textInputContainer = document.getElementById("text-input-container");
        const placeholder = document.getElementById("placeholder");

        event.preventDefault();

        // Show text input again
        textInputContainer.style.display = "block";
        placeholder.style.display = "none";

        if (fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            showLoadingMessage(`Analyzing "${fileName}", please wait...`);
            uploadFile(fileInput.files[0]);
            fileInput.value = "";
            document.getElementById("file-name").textContent = "";
        } else if (userInput && userInput.value.trim() !== "") {
            sendMessage();
        }
    }
});



function updateFileLabel() {
    var fileInput = document.getElementById("file-input");
    var fileNameDisplay = document.getElementById("file-name");
    var textInputContainer = document.getElementById("text-input-container");
    var placeholder = document.getElementById("placeholder");

    if (fileInput.files.length > 0) {
        fileNameDisplay.textContent = fileInput.files[0].name;
        textInputContainer.style.display = "none";
        placeholder.style.display = "block";
    } else {
        fileNameDisplay.textContent = "";
        textInputContainer.style.display = "block";
        placeholder.style.display = "none";
    }
}


</script>

</body>
{% endblock %}